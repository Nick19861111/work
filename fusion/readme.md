# 两个web游戏引擎的融合方案

### 为什么要做这个方案

公司的需求就是已经有成熟点的以前运营的游戏，并且收入不错，然而以前使用的游戏引擎因为某些原因已经不存在了，公司于是想到现在还非常火的游戏引擎其他的，于是有了现在的想法，就是让原来的游戏暂时不动继续运营，然后后面开发的新游戏就挂在后面单独点开操作，这样既不会影响以前的游戏，也继续开发新的产品可以用到新的技术。

### 融合的两个方案

1. 网页常用的Iframe 方案
2. 把其中的一个引擎引导到另一个引擎的html 增加一个Canvas里面进行渲染，让两个Canvas能够相互调用。

### 测试

#### iframe

第一个方案是成熟的方案，使用Iframe 的属性src 对引擎打包的html主文件进行加载，如果有相关的一些简单的数据，都可以使用postMessage进行传输，然后在对应的接受点使用
`window.addListerent("message",(event)=>{
	log(event.data);
}`
这样我们很方便就从以前的游戏获得对应必须的数据，不过就是每次都要写很多的判断，和发送对应的事件。


#### 两个Canvas的方式

我就用白鹭和cocos做融合的方案

首先把cocos用web打包web版本，然后把整个项目都考入到白鹭的项目下，让cocos和白鹭在一个域下面，然后在把白鹭的启动的html文件新增加几个script加载cocos的必须引入的js，然后创建一个canvas标签，下面思路就是通过id获取白鹭的canvas标签和cocos的标签，使用display的none和block让他们分别的显示和不显示，最关键的一步就是获取来的Canva对象使用获得window对象的方式然后把你要暴露的数据给出去就好，(cocosCanvas.XXXX as any) . 数据对象 = 数据，这样就获取到cocos共享的数据，然后白鹭也是如此我们就可以通过两个Canvas暴露的数据进行数据交互，这样老的游戏的一些数据点击以后新开发的游戏可以获得一些相关的数据，两个游戏引擎从此就融合成功，不光是数据，方法也可以用这样的方式进行操作。

后面一种方案也会存在一些问题，如果有多个小游戏的话，想使用这种方式就比较麻烦，因为cocos打包的原因，内部js相互调用形成特殊位置关键不能通过配置和一些外部的手段进行干预，就会让两个项目看起来有点混乱，然后就是你要暴露的数据最好是和别人商量好，因为ts的接口可以读取数据的方便，就规划好的数据操作，也方便管理

以上的方案都是经过初级的测试，没有真正在项目中测试过，等过几天在项目中进行测试以后在来写遇到的问题和备选方案